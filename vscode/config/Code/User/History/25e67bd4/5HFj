CC = gcc
CFLAGS = -Wall -g 
COMPILE = -c
OUTPUT = -o
OUTPATH = build
APPLICATION = automata
LIBS = 
CMD_RUN = ./$(OUTPATH)/\$(APPLICATION)

define run_std_compilation
	$(CC) $(CFLAGS) $(COMPILE) $< $(OUTPUT) $(OUTPATH)/$@ $(LIBS)
endef

SRCS = $(wildcard */*/*.c) $(wildcard */*.c) $(wildcard *.c) 
OBJS = $(patsubst %.c,%.o,$(SRCS))
OBJS_FILES = $(patsubst %.o,$(OUTPATH)/%.o,$(OBJS))

all: build

run: build start

build: compile link

link: 
	$(CC) $(CFLAGS) $(OUTPUT) \
		$(OUTPATH)/$(APPLICATION) \
		$(OUTPATH)/main.o \
		$(OUTPATH)/metadata-file.o \
		$(OUTPATH)/event-file.o \
		$(OUTPATH)/system/file-utils.o \
		$(OUTPATH)/pending-job-queue.o \
		$(LIBS)

start: 
	$(CMD_RUN)

compile: prepare $(OBJS)

%.o: %.c
	$(call run_std_compilation)

prepare:
	mkdir -p $(OUTPATH)
	mkdir -p $(OUTPATH)/system

clear: 
	rm -rf $(OUTPATH)/*